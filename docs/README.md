# Руководство пользователя (User Manual)

Это руководство предназначено для помощи пользователям в настройке, запуске и использовании проекта автоматизации модерации макетов с использованием искусственного интеллекта. Проект включает в себя анализ изображений, документов, видео и автоматическую разметку данных.

---

## Оглавление

1. [Введение](#введение)
2. [Установка и настройка](#установка-и-настройка)
   - [Требования](#требования)
   - [Установка зависимостей](#установка-зависимостей)
   - [Настройка конфигурационных файлов](#настройка-конфигурационных-файлов)
3. [Запуск проекта](#запуск-проекта)
   - [Обучение модели](#обучение-модели)
   - [Анализ изображений](#анализ-изображений)
   - [Автоматическая разметка](#автоматическая-разметка)
   - [Уведомления](#уведомления)
4. [Работа с данными](#работа-с-данными)
   - [Структура папок](#структура-папок)
   - [Форматы данных](#форматы-данных)
5. [Мониторинг и логирование](#мониторинг-и-логирование)
6. [Часто задаваемые вопросы (FAQ)](#часто-задаваемые-вопросы-faq)
7. [Поддержка и обратная связь](#поддержка-и-обратная-связь)

---

## Введение

Проект предназначен для автоматизации процессов модерации рекламных макетов с использованием технологий искусственного интеллекта. Основные функции:
- Анализ изображений на соответствие юридическим требованиям.
- Классификация документов и проверка их содержания.
- Автоматическая разметка данных для обучения моделей.
- Уведомления о завершении задач через Telegram.

---

## Установка и настройка

### Требования

- Операционная система: Linux, Windows или macOS.
- Python 3.9 или выше.
- GPU с поддержкой CUDA (рекомендуется для обучения моделей).
- Установленный Docker (для работы с CVAT).

### Установка зависимостей

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/moderation-ai.git
   cd moderation-ai
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Убедитесь, что CUDA и cuDNN установлены и настроены (если используется GPU).

### Настройка конфигурационных файлов

1. **comet_config.yaml**:
   - Укажите ваш API-ключ Comet ML и настройки проекта.
   ```yaml
   api_key: "your_comet_ml_api_key"
   project_name: "moderation-ai"
   workspace: "your_workspace"
   ```

2. **config.yaml**:
   - Настройте пути к данным и гиперпараметры обучения.
   ```yaml
   data_path: "/mldata/learning/yolo_apteka/data.yaml"
   model_path: "/mldata/learning/yolo_apteka/runs"
   hyperparameters:
     learning_rate: 0.001
     batch_size: 24
   ```

3. **document_analysis.yaml**:
   - Настройте категории и ключевые слова для анализа документов.
   ```yaml
   categories:
     - "Доставка еды"
     - "Лекарственные препараты"
   keywords:
     Доставка еды:
       - "доставка еды"
       - "заказ еды"
   ```

---

## Запуск проекта

### Обучение модели

1. Запустите обучение модели YOLO:
   ```bash
   bash scripts/run_comet_pipeline.sh
   ```
   - Скрипт автоматически проверит доступность GPU и запустит обучение.
   - Результаты обучения будут сохранены в папке `data/models/`.

2. Отслеживайте прогресс обучения в Comet ML.

### Анализ изображений

1. Поместите изображения для анализа в папку `data/images/`.
2. Запустите скрипт анализа:
   ```bash
   python scripts/process_images.py
   ```
   - Результаты анализа будут сохранены в `data/results/results.csv`.

### Автоматическая разметка

1. Настройте доступ к CVAT:
   - Укажите логин и пароль в командной строке:
     ```powershell
     $login = "admin"
     $plainPass = "your_password"
     ```
   - Запустите авторазметку:
     ```powershell
     cvat-cli.exe --server-host 146.185.208.173:8089 --auth mcdis:TeamDeveloper auto-annotate 40 --function-file ./scripts/auto_annotation.py --allow-unmatched-labels --clear-existing
     ```

### Уведомления

1. Настройте Telegram-бота:
   - Укажите токен бота и ваш User ID в `scripts/notify_bot.py`.
   ```python
   BOT_TOKEN = "your_telegram_bot_token"
   USER_ID = "your_user_id"
   ```
2. Запустите бота:
   ```bash
   python scripts/notify_bot.py
   ```
3. Бот будет отправлять уведомления о завершении задач.

---

## Работа с данными

### Структура папок

- **data/images/**: Изображения для анализа.
- **data/models/**: Обученные модели.
- **data/logs/**: Логи выполнения скриптов.
- **data/results/**: Результаты анализа.

### Форматы данных

- Изображения: `.jpg`, `.jpeg`, `.png`.
- Модели: `.pt` (YOLO), `.bin` (Qwen2VL).
- Логи: `.log`.
- Результаты: `.csv`.

---

## Мониторинг и логирование

- Логи сохраняются в папке `data/logs/`.
- Используйте скрипт `scripts/parse_log_to_excel.py` для анализа логов:
  ```bash
  python scripts/parse_log_to_excel.py /path/to/logfile.log
  ```

---

## Часто задаваемые вопросы (FAQ)

### 1. Как добавить новую категорию для анализа?
- Отредактируйте файл `config/document_analysis.yaml`, добавив новую категорию и ключевые слова.

### 2. Как изменить гиперпараметры обучения?
- Отредактируйте файл `config/config.yaml`, изменив параметры в разделе `hyperparameters`.

### 3. Как настроить уведомления в Telegram?
- Укажите токен бота и ваш User ID в `scripts/notify_bot.py`.

---

Это руководство поможет быстро освоить проект и эффективно использовать его возможности.
